> Sys.setlocale("LC_COLLATE", "C")
[1] "C"
> Sys.setlocale("LC_TIME", "C")
[1] "C"
> Sys.setenv(TZ='EST') # so that tests that print out time zone work everywhere
> options(error = function() NULL, showErrorCalls = FALSE)
> date <- as.Date("2009/1/1") + -5:5; cat(paste(format(date), " ", format(dateShift(date, by = "days", k.by = 1, direction = -1))), sep = "\n")
2008-12-27   2008-12-26
2008-12-28   2008-12-27
2008-12-29   2008-12-28
2008-12-30   2008-12-29
2008-12-31   2008-12-30
2009-01-01   2008-12-31
2009-01-02   2009-01-01
2009-01-03   2009-01-02
2009-01-04   2009-01-03
2009-01-05   2009-01-04
2009-01-06   2009-01-05
> date <- as.Date("2009/1/1") + -5:5; cat(paste(format(date), " ", format(dateShift(date, by = "days", k.by = 3, direction = -1))), sep = "\n")
2008-12-27   2008-12-24
2008-12-28   2008-12-25
2008-12-29   2008-12-26
2008-12-30   2008-12-27
2008-12-31   2008-12-28
2009-01-01   2008-12-29
2009-01-02   2008-12-30
2009-01-03   2008-12-31
2009-01-04   2009-01-01
2009-01-05   2009-01-02
2009-01-06   2009-01-03
> date <- as.Date("2009/1/1") + -5:5; cat(paste(format(date), " ", format(dateShift(date, by = "days", k.by = 7, direction = -1))), sep = "\n") 
2008-12-27   2008-12-20
2008-12-28   2008-12-21
2008-12-29   2008-12-22
2008-12-30   2008-12-23
2008-12-31   2008-12-24
2009-01-01   2008-12-25
2009-01-02   2008-12-26
2009-01-03   2008-12-27
2009-01-04   2008-12-28
2009-01-05   2008-12-29
2009-01-06   2008-12-30
> date <- as.Date("2009/1/1") + -5:5; cat(paste(format(date), " ", format(dateShift(date, by = "days", k.by = 1, direction = 1))), sep = "\n") 
2008-12-27   2008-12-28
2008-12-28   2008-12-29
2008-12-29   2008-12-30
2008-12-30   2008-12-31
2008-12-31   2009-01-01
2009-01-01   2009-01-02
2009-01-02   2009-01-03
2009-01-03   2009-01-04
2009-01-04   2009-01-05
2009-01-05   2009-01-06
2009-01-06   2009-01-07
> date <- as.Date("2009/1/1") + -5:5; cat(paste(format(date), " ", format(dateShift(date, by = "days", k.by = 3, direction = 1))), sep = "\n") 
2008-12-27   2008-12-30
2008-12-28   2008-12-31
2008-12-29   2009-01-01
2008-12-30   2009-01-02
2008-12-31   2009-01-03
2009-01-01   2009-01-04
2009-01-02   2009-01-05
2009-01-03   2009-01-06
2009-01-04   2009-01-07
2009-01-05   2009-01-08
2009-01-06   2009-01-09
> date <- as.Date("2009/1/1") + -5:5; cat(paste(format(date), " ", format(dateShift(date, by = "days", k.by = 7, direction = 1))), sep = "\n") 
2008-12-27   2009-01-03
2008-12-28   2009-01-04
2008-12-29   2009-01-05
2008-12-30   2009-01-06
2008-12-31   2009-01-07
2009-01-01   2009-01-08
2009-01-02   2009-01-09
2009-01-03   2009-01-10
2009-01-04   2009-01-11
2009-01-05   2009-01-12
2009-01-06   2009-01-13
> for (i in -5:5) { date <- as.Date("2009/1/1") + i; cat(format(date), " ", format(dateShift(date, by = "days", k.by = 7, direction = 1)), "\n") }
2008-12-27   2009-01-03 
2008-12-28   2009-01-04 
2008-12-29   2009-01-05 
2008-12-30   2009-01-06 
2008-12-31   2009-01-07 
2009-01-01   2009-01-08 
2009-01-02   2009-01-09 
2009-01-03   2009-01-10 
2009-01-04   2009-01-11 
2009-01-05   2009-01-12 
2009-01-06   2009-01-13 
> date <- as.Date("2009/1/1") + -5:5; cat(paste(format(date), " ", format(dateShift(date, by = "bizdays", k.by = 1, direction = -1))), sep = "\n") 
2008-12-27   2008-12-26
2008-12-28   2008-12-26
2008-12-29   2008-12-26
2008-12-30   2008-12-29
2008-12-31   2008-12-30
2009-01-01   2008-12-31
2009-01-02   2009-01-01
2009-01-03   2009-01-02
2009-01-04   2009-01-02
2009-01-05   2009-01-02
2009-01-06   2009-01-05
> date <- as.Date("2009/1/1") + -5:5; cat(paste(format(date), " ", format(dateShift(date, by = "bizdays", k.by = 1, direction = 1))), sep = "\n") 
2008-12-27   2008-12-29
2008-12-28   2008-12-29
2008-12-29   2008-12-30
2008-12-30   2008-12-31
2008-12-31   2009-01-01
2009-01-01   2009-01-02
2009-01-02   2009-01-05
2009-01-03   2009-01-05
2009-01-04   2009-01-05
2009-01-05   2009-01-06
2009-01-06   2009-01-07
> date <- as.Date("2009/1/1") + -5:5; cat(paste(format(date), " ", format(dateShift(date, by = "bizdays", k.by = 3, direction = -1))), sep = "\n")
2008-12-27   2008-12-24
2008-12-28   2008-12-24
2008-12-29   2008-12-24
2008-12-30   2008-12-25
2008-12-31   2008-12-26
2009-01-01   2008-12-29
2009-01-02   2008-12-30
2009-01-03   2008-12-31
2009-01-04   2008-12-31
2009-01-05   2008-12-31
2009-01-06   2009-01-01
> date <- as.Date("2009/1/1") + -5:5; cat(paste(format(date), " ", format(dateShift(date, by = "bizdays", k.by = 3))), sep = "\n")
2008-12-27   2008-12-31
2008-12-28   2008-12-31
2008-12-29   2009-01-01
2008-12-30   2009-01-02
2008-12-31   2009-01-05
2009-01-01   2009-01-06
2009-01-02   2009-01-07
2009-01-03   2009-01-07
2009-01-04   2009-01-07
2009-01-05   2009-01-08
2009-01-06   2009-01-09
> library(Holidays)
#@ ignore-output
> date <- as.Date("2009/1/1") + -8:2; cat(paste(format(date), " ", format(dateShift(date, by = "bizdays", k.by = 1, direction = -1, holidays = "NYSEC"))), sep = "\n")
2008-12-24   2008-12-23
2008-12-25   2008-12-24
2008-12-26   2008-12-24
2008-12-27   2008-12-26
2008-12-28   2008-12-26
2008-12-29   2008-12-26
2008-12-30   2008-12-29
2008-12-31   2008-12-30
2009-01-01   2008-12-31
2009-01-02   2008-12-31
2009-01-03   2009-01-02
> date <- as.Date("2009/1/1") + -8:2; cat(paste(format(date), " ", format(dateShift(date, by = "bizdays", k.by = 1, direction = 1, holidays = "NYSEC"))), sep = "\n")
2008-12-24   2008-12-26
2008-12-25   2008-12-26
2008-12-26   2008-12-29
2008-12-27   2008-12-29
2008-12-28   2008-12-29
2008-12-29   2008-12-30
2008-12-30   2008-12-31
2008-12-31   2009-01-02
2009-01-01   2009-01-02
2009-01-02   2009-01-05
2009-01-03   2009-01-05
> date <- as.Date("2009/1/1") + -8:2; cat(paste(format(date), " ", format(dateShift(date, by = "bizdays", k.by = 1, direction = -1, holidays = "NONE"))), sep = "\n")
2008-12-24   2008-12-23
2008-12-25   2008-12-24
2008-12-26   2008-12-25
2008-12-27   2008-12-26
2008-12-28   2008-12-26
2008-12-29   2008-12-26
2008-12-30   2008-12-29
2008-12-31   2008-12-30
2009-01-01   2008-12-31
2009-01-02   2009-01-01
2009-01-03   2009-01-02
> for (i in -8:2) { date <- as.Date("2009/1/1") + i; cat(format(date), " ", format(dateShift(date, by = "bizdays", k.by = 1, direction = -1, holidays = "NONE")), "\n") }
2008-12-24   2008-12-23 
2008-12-25   2008-12-24 
2008-12-26   2008-12-25 
2008-12-27   2008-12-26 
2008-12-28   2008-12-26 
2008-12-29   2008-12-26 
2008-12-30   2008-12-29 
2008-12-31   2008-12-30 
2009-01-01   2008-12-31 
2009-01-02   2009-01-01 
2009-01-03   2009-01-02 
> date <- as.Date("2009/1/1") + 1:10; cat(paste(format(date), " ", format(dateShift(date, by = "weeks", k.by = 1, direction = -1))), sep = "\n")
2009-01-02   2008-12-26
2009-01-03   2008-12-27
2009-01-04   2008-12-28
2009-01-05   2008-12-29
2009-01-06   2008-12-30
2009-01-07   2008-12-31
2009-01-08   2009-01-01
2009-01-09   2009-01-02
2009-01-10   2009-01-03
2009-01-11   2009-01-04
> date <- as.Date("2009/1/1") + 1:10; cat(paste(format(date), " ", format(dateShift(date, by = "weeks", k.by = 1, direction = 1))), sep = "\n")
2009-01-02   2009-01-09
2009-01-03   2009-01-10
2009-01-04   2009-01-11
2009-01-05   2009-01-12
2009-01-06   2009-01-13
2009-01-07   2009-01-14
2009-01-08   2009-01-15
2009-01-09   2009-01-16
2009-01-10   2009-01-17
2009-01-11   2009-01-18
> for (i in 1:10) { date <- as.Date("2009/1/1") + i; cat(format(date), " ", format(dateShift(date, by = "weeks", k.by = 1, direction = 1)), "\n") }
2009-01-02   2009-01-09 
2009-01-03   2009-01-10 
2009-01-04   2009-01-11 
2009-01-05   2009-01-12 
2009-01-06   2009-01-13 
2009-01-07   2009-01-14 
2009-01-08   2009-01-15 
2009-01-09   2009-01-16 
2009-01-10   2009-01-17 
2009-01-11   2009-01-18 
> date <- as.Date("2009/1/1") + (-1:10)*15; cat(paste(format(date), " ", format(dateShift(date, by = "months", k.by = 1, direction = -1))), sep = "\n")
2008-12-17   2008-11-17
2009-01-01   2008-12-01
2009-01-16   2008-12-16
2009-01-31   2008-12-31
2009-02-15   2009-01-15
2009-03-02   2009-02-02
2009-03-17   2009-02-17
2009-04-01   2009-03-01
2009-04-16   2009-03-16
2009-05-01   2009-04-01
2009-05-16   2009-04-16
2009-05-31   2009-05-01
> date <- as.Date("2009/1/1") + (-1:10)*15; cat(paste(format(date), " ", format(dateShift(date, by = "months", k.by = 2, direction = -1))), sep = "\n") 
2008-12-17   2008-10-17
2009-01-01   2008-11-01
2009-01-16   2008-11-16
2009-01-31   2008-12-01
2009-02-15   2008-12-15
2009-03-02   2009-01-02
2009-03-17   2009-01-17
2009-04-01   2009-02-01
2009-04-16   2009-02-16
2009-05-01   2009-03-01
2009-05-16   2009-03-16
2009-05-31   2009-03-31
> date <- as.Date("2009/1/1") + (-1:10)*15; cat(paste(format(date), " ", format(dateShift(date, by = "months", k.by = 3, direction = -1))), sep = "\n") 
2008-12-17   2008-09-17
2009-01-01   2008-10-01
2009-01-16   2008-10-16
2009-01-31   2008-10-31
2009-02-15   2008-11-15
2009-03-02   2008-12-02
2009-03-17   2008-12-17
2009-04-01   2009-01-01
2009-04-16   2009-01-16
2009-05-01   2009-02-01
2009-05-16   2009-02-16
2009-05-31   2009-03-03
> date <- as.Date("2009/1/1") + (-1:10)*15; cat(paste(format(date), " ", format(dateShift(date, by = "months", k.by = 1, direction = 1))), sep = "\n") 
2008-12-17   2009-01-17
2009-01-01   2009-02-01
2009-01-16   2009-02-16
2009-01-31   2009-03-03
2009-02-15   2009-03-15
2009-03-02   2009-04-02
2009-03-17   2009-04-17
2009-04-01   2009-05-01
2009-04-16   2009-05-16
2009-05-01   2009-06-01
2009-05-16   2009-06-16
2009-05-31   2009-07-01
> date <- as.Date("2009/1/1") + (-1:10)*15; cat(paste(format(date), " ", format(dateShift(date, by = "months", k.by = 2, direction = 1))), sep = "\n") 
2008-12-17   2009-02-17
2009-01-01   2009-03-01
2009-01-16   2009-03-16
2009-01-31   2009-03-31
2009-02-15   2009-04-15
2009-03-02   2009-05-02
2009-03-17   2009-05-17
2009-04-01   2009-06-01
2009-04-16   2009-06-16
2009-05-01   2009-07-01
2009-05-16   2009-07-16
2009-05-31   2009-07-31
> date <- as.Date("2009/1/1") + (-1:10)*15; cat(paste(format(date), " ", format(dateShift(date, by = "months", k.by = 3, direction = 1))), sep = "\n") 
2008-12-17   2009-03-17
2009-01-01   2009-04-01
2009-01-16   2009-04-16
2009-01-31   2009-05-01
2009-02-15   2009-05-15
2009-03-02   2009-06-02
2009-03-17   2009-06-17
2009-04-01   2009-07-01
2009-04-16   2009-07-16
2009-05-01   2009-08-01
2009-05-16   2009-08-16
2009-05-31   2009-08-31
> for (i in -1:10) { date <- as.Date("2009/1/1") + i*15; cat(format(date), " ", format(dateShift(date, by = "months", k.by = 3, direction = 1)), "\n") }
2008-12-17   2009-03-17 
2009-01-01   2009-04-01 
2009-01-16   2009-04-16 
2009-01-31   2009-05-01 
2009-02-15   2009-05-15 
2009-03-02   2009-06-02 
2009-03-17   2009-06-17 
2009-04-01   2009-07-01 
2009-04-16   2009-07-16 
2009-05-01   2009-08-01 
2009-05-16   2009-08-16 
2009-05-31   2009-08-31 
> date <- as.Date(paste(2001:2008, "/1/1", sep = "")); cat(paste(format(date), " ", format(dateShift(date, by = "years", k.by = 1, direction = -1))), sep = "\n")
2001-01-01   2000-01-01
2002-01-01   2001-01-01
2003-01-01   2002-01-01
2004-01-01   2003-01-01
2005-01-01   2004-01-01
2006-01-01   2005-01-01
2007-01-01   2006-01-01
2008-01-01   2007-01-01
> date <- as.Date(paste(2001:2008, "/1/1", sep = "")); cat(paste(format(date), " ", format(dateShift(date, by = "years", k.by = 2, direction = -1))), sep = "\n")
2001-01-01   1999-01-01
2002-01-01   2000-01-01
2003-01-01   2001-01-01
2004-01-01   2002-01-01
2005-01-01   2003-01-01
2006-01-01   2004-01-01
2007-01-01   2005-01-01
2008-01-01   2006-01-01
> date <- as.Date(paste(2001:2008, "/1/1", sep = "")); cat(paste(format(date), " ", format(dateShift(date, by = "years", k.by = 3, direction = -1))), sep = "\n")
2001-01-01   1998-01-01
2002-01-01   1999-01-01
2003-01-01   2000-01-01
2004-01-01   2001-01-01
2005-01-01   2002-01-01
2006-01-01   2003-01-01
2007-01-01   2004-01-01
2008-01-01   2005-01-01
> date <- as.Date(paste(2001:2008, "/1/1", sep = "")); cat(paste(format(date), " ", format(dateShift(date, by = "years", k.by = 1, direction = 1))), sep = "\n")
2001-01-01   2002-01-01
2002-01-01   2003-01-01
2003-01-01   2004-01-01
2004-01-01   2005-01-01
2005-01-01   2006-01-01
2006-01-01   2007-01-01
2007-01-01   2008-01-01
2008-01-01   2009-01-01
> date <- as.Date(paste(2001:2008, "/1/1", sep = "")); cat(paste(format(date), " ", format(dateShift(date, by = "years", k.by = 2, direction = 1))), sep = "\n")
2001-01-01   2003-01-01
2002-01-01   2004-01-01
2003-01-01   2005-01-01
2004-01-01   2006-01-01
2005-01-01   2007-01-01
2006-01-01   2008-01-01
2007-01-01   2009-01-01
2008-01-01   2010-01-01
> date <- as.Date(paste(2001:2008, "/1/1", sep = "")); cat(paste(format(date), " ", format(dateShift(date, by = "years", k.by = 3, direction = 1))), sep = "\n")
2001-01-01   2004-01-01
2002-01-01   2005-01-01
2003-01-01   2006-01-01
2004-01-01   2007-01-01
2005-01-01   2008-01-01
2006-01-01   2009-01-01
2007-01-01   2010-01-01
2008-01-01   2011-01-01
> date <- as.Date(paste(2001:2008, "/1/2", sep = "")); cat(paste(format(date), " ", format(dateShift(date, by = "years", k.by = 1, direction = -1))), sep = "\n")
2001-01-02   2000-01-02
2002-01-02   2001-01-02
2003-01-02   2002-01-02
2004-01-02   2003-01-02
2005-01-02   2004-01-02
2006-01-02   2005-01-02
2007-01-02   2006-01-02
2008-01-02   2007-01-02
> date <- as.Date(paste(2001:2008, "/1/2", sep = "")); cat(paste(format(date), " ", format(dateShift(date, by = "years", k.by = 2, direction = -1))), sep = "\n")
2001-01-02   1999-01-02
2002-01-02   2000-01-02
2003-01-02   2001-01-02
2004-01-02   2002-01-02
2005-01-02   2003-01-02
2006-01-02   2004-01-02
2007-01-02   2005-01-02
2008-01-02   2006-01-02
> date <- as.Date(paste(2001:2008, "/1/2", sep = "")); cat(paste(format(date), " ", format(dateShift(date, by = "years", k.by = 3, direction = -1))), sep = "\n")
2001-01-02   1998-01-02
2002-01-02   1999-01-02
2003-01-02   2000-01-02
2004-01-02   2001-01-02
2005-01-02   2002-01-02
2006-01-02   2003-01-02
2007-01-02   2004-01-02
2008-01-02   2005-01-02
> date <- as.Date(paste(2001:2008, "/1/2", sep = "")); cat(paste(format(date), " ", format(dateShift(date, by = "years", k.by = 1, direction = 1))), sep = "\n")
2001-01-02   2002-01-02
2002-01-02   2003-01-02
2003-01-02   2004-01-02
2004-01-02   2005-01-02
2005-01-02   2006-01-02
2006-01-02   2007-01-02
2007-01-02   2008-01-02
2008-01-02   2009-01-02
> date <- as.Date(paste(2001:2008, "/1/2", sep = "")); cat(paste(format(date), " ", format(dateShift(date, by = "years", k.by = 2, direction = 1))), sep = "\n")
2001-01-02   2003-01-02
2002-01-02   2004-01-02
2003-01-02   2005-01-02
2004-01-02   2006-01-02
2005-01-02   2007-01-02
2006-01-02   2008-01-02
2007-01-02   2009-01-02
2008-01-02   2010-01-02
> date <- as.Date(paste(2001:2008, "/1/2", sep = "")); cat(paste(format(date), " ", format(dateShift(date, by = "years", k.by = 3, direction = 1))), sep = "\n")
2001-01-02   2004-01-02
2002-01-02   2005-01-02
2003-01-02   2006-01-02
2004-01-02   2007-01-02
2005-01-02   2008-01-02
2006-01-02   2009-01-02
2007-01-02   2010-01-02
2008-01-02   2011-01-02
> for (year in 2001:2008) { date <- as.Date(paste(year, "/1/2", sep = "")); cat(format(date), " ", format(dateShift(date, by = "years", k.by = 3, direction = 1)), "\n") }
2001-01-02   2004-01-02 
2002-01-02   2005-01-02 
2003-01-02   2006-01-02 
2004-01-02   2007-01-02 
2005-01-02   2008-01-02 
2006-01-02   2009-01-02 
2007-01-02   2010-01-02 
2008-01-02   2011-01-02 
> dateShift("2007/12/06", by = "days", k.by = 4, direction = -1)
[1] "2007-12-02"
> dateShift("2007/12/06", by = "days", k.by = 3, direction = -1)
[1] "2007-12-03"
> dateShift("2007/12/06", by = "days", k.by = 2, direction = -1)
[1] "2007-12-04"
> dateShift("2007/12/06", by = "days", k.by = 1, direction = -1)
[1] "2007-12-05"
> dateShift("2007/12/06", by = "days", k.by = 0, direction = -1)
#@ ignore-linebreaks
Error in dateShift.default("2007/12/06", by = "days", k.by = 0, direction = -1) : 
  when using 'by = "days"', 'k.by' must be in the range: 1:30.
> dateShift("2007/12/06", by = "days", k.by = 1, direction = 1)
[1] "2007-12-07"
> dateShift("2007/12/06", by = "days", k.by = 2, direction = 1)
[1] "2007-12-08"
> dateShift("2007/12/06", by = "days", k.by = 3, direction = 1)
[1] "2007-12-09"
> dow <- function(x) if (!is.null(x)) { x <- dateParse(x); paste(format(x, "%Y/%m/%d"), " (", weekdays(x, T), ")", sep = "") } else ""
> span <- function(x, len) { res <- rep("                ", len); res[1:length(x)] <- x; res}
> pp <- function(x, y = NULL) if (length(x) == length(y)) cat(paste(dow(x), "->", dow(y), "\n"), sep = "") else { len <- max(length(x), length(y)); cat(paste(span(dow(x), len), "  ", span(dow(y), len), "\n"), sep = "") }
> date <- as.Date("2009/1/15") + 0:10
> pp(date, dateShift(date, by = "bizdays", direction = -1, holidays = "NYSEC"))
2009/01/15 (Thu) -> 2009/01/14 (Wed) 
2009/01/16 (Fri) -> 2009/01/15 (Thu) 
2009/01/17 (Sat) -> 2009/01/16 (Fri) 
2009/01/18 (Sun) -> 2009/01/16 (Fri) 
2009/01/19 (Mon) -> 2009/01/16 (Fri) 
2009/01/20 (Tue) -> 2009/01/16 (Fri) 
2009/01/21 (Wed) -> 2009/01/20 (Tue) 
2009/01/22 (Thu) -> 2009/01/21 (Wed) 
2009/01/23 (Fri) -> 2009/01/22 (Thu) 
2009/01/24 (Sat) -> 2009/01/23 (Fri) 
2009/01/25 (Sun) -> 2009/01/23 (Fri) 
> pp(date, dateShift(date, by = "bizdays", direction = 1, holidays = "NYSEC"))
2009/01/15 (Thu) -> 2009/01/16 (Fri) 
2009/01/16 (Fri) -> 2009/01/20 (Tue) 
2009/01/17 (Sat) -> 2009/01/20 (Tue) 
2009/01/18 (Sun) -> 2009/01/20 (Tue) 
2009/01/19 (Mon) -> 2009/01/20 (Tue) 
2009/01/20 (Tue) -> 2009/01/21 (Wed) 
2009/01/21 (Wed) -> 2009/01/22 (Thu) 
2009/01/22 (Thu) -> 2009/01/23 (Fri) 
2009/01/23 (Fri) -> 2009/01/26 (Mon) 
2009/01/24 (Sat) -> 2009/01/26 (Mon) 
2009/01/25 (Sun) -> 2009/01/26 (Mon) 
> # The following checksum agrees with S-PLUS.
> allDates <- dateSeq(as.Date("1980/1/1"), "2009/1/22")
> length(allDates)
[1] 10615
> sum(dateShift(allDates, by = "bizdays", holidays = "NYSEC") - allDates)
Time difference of 15776 days
